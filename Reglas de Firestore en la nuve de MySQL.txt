rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // El cliente s√≥lo puede leer/escribir su propio users/{uid}
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Cliente puede escuchar su playSubscriptions/{token} propio para navegaci√≥n r√°pida
    match /playSubscriptions/{purchaseToken} {
      allow read: if request.auth != null
                  && (resource == null || (
                        resource.data.uid != null &&
                        resource.data.uid == request.auth.uid
                  ));
      allow write: if false;
    }

    // üîπ Config: permitir solo lectura del doc appUpdate
    match /config/{docId} {
      allow read: if docId == "appUpdate";
      allow write: if false;
    }

    // Backends √∫nicamente
    match /purchaseLinks/{id} { allow read, write: if false; }
    match /accountMap/{id}    { allow read, write: if false; }
    match /rtdn_raw/{id}      { allow read, write: if false; }
  }
}